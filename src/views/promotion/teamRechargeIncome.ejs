<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level UP Reward - DeltInWin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" crossorigin="" href="/index_files/index-BUBUniRp.css">
</head>

<body style="font-size: 12px;">
    <div id="root">
        <div class="mainApp">
            <div class="container-fluid" style="padding: 4px 12px;">
                <div class="row align-items-center mb-3">
                    <div class="col-2">
                        <a href="/promotion" class="text-decoration-none">
                            <i class="fa-solid fa-arrow-left text-theme1" style="font-size: 20px;"></i>
                        </a>
                    </div>
                    <div class="col-8 text-center">
                        <h5 class="mb-0 text-theme1 fw-bold">Level UP Reward</h5>
                    </div>
                    <div class="col-2"></div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <div class="card bg-gradient-warning text-white border-0 rounded-3">
                            <div class="card-body text-center" style="
    background: linear-gradient(90deg, #E67302 0%, #ee0a24 100%);
">
                                <h6 class="card-title mb-2">Total Level UP Rewards</h6>
                                <h2 class="mb-0" id="total-rewards">₹0.00</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card border-0 rounded-3">
                            <div class="card-header bg-theme1 text-white">
                                <h6 class="mb-0">Reward History</h6>
                            </div>
                            <div class="card-body p-0">
                                <div id="reward-list" class="list-group list-group-flush">
                                    <div class="list-group-item text-center py-4">
                                        <i class="fa-solid fa-trophy text-muted" style="font-size: 48px;"></i>
                                        <p class="mt-2 mb-0 text-muted">No level up reward data available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/js/client.js"></script>
   <script>
    $(document).ready(function () {
        console.log('Level Bonus page loaded');
        loadLevelBonusData();
    });

    function loadLevelBonusData() {
        $('#total-rewards').text('Loading...');
        $('#reward-list').html(`
            <div class="list-group-item text-center py-4">
                <i class="fa-solid fa-spinner fa-spin text-muted" style="font-size: 48px;"></i>
                <p class="mt-2 mb-0 text-muted">Loading reward data...</p>
            </div>
        `);

        $.post("/api/webapi/rechargeBonus", {}, function (res) {
            if (res.status) {
                updateRewardUI(res);
            } else {
                showError("Failed to load reward data");
            }
        }).fail(function () {
            showError("Failed to fetch reward data");
        });
    }

    function updateRewardUI(data) {
        const levelBonuses = data.level_bonus || [];
        let totalRewards = 0;

        // Sum total rewards
        levelBonuses.forEach(bonus => {
            totalRewards += parseFloat(bonus.amount || 0);
        });

        $('#total-rewards').text(`₹${totalRewards.toFixed(2)}`);
        renderLevelBonusList(levelBonuses);
    }

   function renderLevelBonusList(levelBonuses) {
    const rewardList = $('#reward-list');

    if (levelBonuses.length === 0) {
        rewardList.html(`
            <div class="list-group-item text-center py-4">
                <i class="fa-solid fa-trophy text-muted" style="font-size: 48px;"></i>
                <p class="mt-2 mb-0 text-muted">No level up reward data available</p>
            </div>
        `);
        return;
    }

    let rewardHTML = '';
    levelBonuses.forEach((bonus, index) => {
        const amount = parseFloat(bonus.amount || 0);
        const level = bonus.level || '-';
        const date = bonus.date ? formatDate(bonus.date) : 'N/A';

        const fromUser = bonus.from_user || {};
        const phone = fromUser.phone || 'Unknown';
        const name = fromUser.name || '';

        const maskedPhone = phone.length >= 10
            ? `${phone.slice(0, 2)}****${phone.slice(-4)}`
            : phone;

        rewardHTML += `
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <i class="fa-solid fa-medal text-success"></i>
                    <div class="ms-3">
                        <h6 class="mb-0">Level ${level} Bonus</h6>
                        <small class="text-muted">From: ${maskedPhone} ${name ? `(${name})` : ''}</small><br>
                        <small class="text-muted">Reward: ₹${amount.toFixed(2)}</small>
                    </div>
                </div>
                <div class="text-end">
                    <span class="badge bg-success">Level ${level}</span><br>
                    <small class="text-muted">${date}</small>
                </div>
            </div>
        `;
    });

    rewardList.html(rewardHTML);
}

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-IN', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }

    function showError(message) {
        $('#total-rewards').text('₹0.00');
        $('#reward-list').html(`
            <div class="list-group-item text-center py-4">
                <i class="fa-solid fa-exclamation-triangle text-danger" style="font-size: 48px;"></i>
                <p class="mt-2 mb-0 text-danger">${message}</p>
                <button class="btn btn-sm btn-outline-primary mt-2" onclick="loadLevelBonusData()">Retry</button>
            </div>
        `);
    }
</script>

</body>

</html>